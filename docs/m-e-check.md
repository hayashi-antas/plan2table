# M-E-Check 機能ドキュメント

**M-E-Check**（Machine-Equipment Check）は、**機器表PDF** と **盤表PDF** の2つをアップロードするだけで、両方の記載が一致しているかを自動で照合する機能です。結果は画面上の表で確認でき、CSV でダウンロードできます。

---

## 何ができるか

| 入力 | 出力 |
|------|------|
| 機器表PDF（換気・空調などの機器一覧） | 照合結果の **一覧表**（HTML） |
| 盤表PDF（電力制御盤の機器一覧） | **unified.csv**（ダウンロード） |

**照合のポイント**: **機器表の情報を正（基準）として**、機器番号ごとに「盤表に記載があるか」「台数が一致するか」「容量(kW)が一致するか」を判定し、**一致 / 不一致** を表示します。

---

## 処理の流れ（図）

```
┌─────────────────┐     ┌─────────────────┐
│   機器表PDF      │     │    盤表PDF      │
│ (表形式・ベクトル) │     │ (スキャン画像等)  │
└────────┬────────┘     └────────┬────────┘
         │                       │
         ▼                       ▼
   ┌───────────┐           ┌───────────┐
   │  Vector   │           │  Raster   │
   │  抽出     │           │  (OCR)    │
   │ pdfplumber│           │ Vision API│
   └─────┬─────┘           └─────┬─────┘
         │                       │
         │  vector.csv           │  raster.csv
         │                       │
         └───────────┬───────────┘
                     │
                     ▼
              ┌─────────────┐
              │   Unified   │
              │ 機器番号で結合 │
              │ 一致判定     │
              └──────┬──────┘
                     │
                     ▼
              unified.csv
              （照合結果・台数差・容量差など）
```

**用語の意味**

- **Vector** … 機器表PDFから表構造を読み取って作ったCSV（テキストベース）
- **Raster** … 盤表PDFを画像にしてOCRして作ったCSV（スキャン向け）
- **Unified** … 上記2つを機器番号でつなぎ、一致/不一致を付けた統合CSV

---

## 使い方

1. アプリの **M-E Check** ページ（`/me-check`）を開く
2. **機器表PDF** と **盤表PDF** を選択（ドラッグ＆ドロップまたはファイル選択）
3. **「実行する」** をクリック
4. 処理後、画面上に **照合結果の表** が表示され、**CSVダウンロード** のリンクが表示される

[![Image from Gyazo](https://i.gyazo.com/a50257df6615efee6be846cd8a93a522.png)](https://gyazo.com/a50257df6615efee6be846cd8a93a522)

[![Image from Gyazo](https://i.gyazo.com/c5cd46494476a9628fa6cc1da20ae952.png)](https://gyazo.com/c5cd46494476a9628fa6cc1da20ae952)

---

## 画面に表示される列（CSVも同様）


| 列 | 説明 |
|----|------|
| 照合結果 | 一致 / 不一致|
| 不一致内容 | 盤表に記載なし、機器表に記載なし、台数差分、容量差分など |
| 機器ID・機器表 記載名 | 機器番号と機器表に記載された名称 |
| 盤表 記載名 / 名称差異 | 盤表側の記載名と、機器表名と差異がある場合の `あり` 表示（判定には非影響） |
| 機器表 台数 / 盤表 台数 | それぞれの台数 |
| 台数差・容量差 | 盤表 − 機器表の差分 |
| 機器表 図面番号 | 機器表側の図面番号（同一機器番号で複数ある場合はカンマ併記） |
| 盤表 図面番号 | 盤表側の図面番号（同一機器番号に複数ある場合は `E-024,E-031` のように併記） |

---

## 詳細ドキュメント

処理の内部仕様・API・列の対応・開発者向け情報は、次のファイルにまとめています。

**[m-e-check-detail.md](m-e-check-detail.md)** … 用語定義、抽出処理の詳細、Unified の判定ロジック、エンドポイント一覧、環境設定など
